{"is_source_file": true, "format": "Python", "description": "This file defines API route handlers for product, alert, and job management in a FastAPI application. It includes endpoints for listing, creating, retrieving, updating, and deleting products; listing alerts; and a job endpoint for fetching latest product prices and creating alerts. The code interacts with database models and schemas, and integrates a pricing service.", "external_files": ["from .db import get_db", "from . import models", "from . import schemas", "from .services import PricingService, maybe_create_alert"], "external_methods": ["get_db()", "PricingService.fetch_latest_price", "maybe_create_alert()"], "published": ["list_products", "create_product", "get_product", "update_product_put", "update_product_patch", "delete_product", "get_price_history", "list_alerts", "fetch_latest_prices_job"], "classes": [], "methods": [{"name": "List[schemas.ProductRead] list_products(db: Session = Depends(get_db))", "description": "Handles GET requests to list all products with nested price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db))", "description": "Handles POST requests to create a new product, optionally with an initial price.", "scope": "", "scopeKind": ""}, {"name": "models.Product _get_product_or_404(db: Session, product_id: int)", "description": "Internal helper to retrieve a product by ID or raise 404 if not found.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead get_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Handles GET request to retrieve a specific product by ID, including price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_put( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Handles PUT request to update/replace product fields.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_patch( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Handles PATCH request for partial product updates, reusing PUT logic.", "scope": "", "scopeKind": ""}, {"name": "None delete_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Handles DELETE request to remove a product and associated data.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.PriceHistoryRead] get_price_history( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Returns all price history entries for a given product.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.AlertRead] list_alerts(db: Session = Depends(get_db))", "description": "Lists all alerts ordered by trigger time.", "scope": "", "scopeKind": ""}, {"name": "dict fetch_latest_prices_job(db: Session = Depends(get_db))", "description": "Fetches latest prices for all products, updates database, and creates alerts when conditions are met.", "scope": "", "scopeKind": ""}], "calls": ["db.query(models.Product).all()", "db.query(models.Product).filter(models.Product.id == product_id).first()", "db.delete(product)", "db.add(...)", "db.commit()", "db.refresh(product)", "db.query(models.PriceHistory).filter(models.PriceHistory.product_id == product_id).order_by(models.PriceHistory.timestamp.asc()).all()", "db.query(models.Alert).order_by(models.Alert.triggered_at.desc()).all()", "pricing_service.fetch_latest_price(p)", "maybe_create_alert(db, p, p.current_price)"], "search-terms": ["FastAPI product routes", "PriceHistory API", "Product CRUD endpoints", "Alert listing", "Fetch latest pricing", "Database session dependency", "Price alert creation", "API router definitions"], "state": 2, "file_id": 9, "knowledge_revision": 27, "git_revision": "38847bfc104168d7cedc087b9606ac73d68658a5", "revision_history": [{"22": ""}, {"27": "38847bfc104168d7cedc087b9606ac73d68658a5"}], "ctags": [{"_type": "tag", "name": "_get_product_or_404", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def _get_product_or_404(db: Session, product_id: int) -> models.Product:$/", "language": "Python", "typeref": "typename:models.Product", "kind": "function", "signature": "(db: Session, product_id: int)"}, {"_type": "tag", "name": "alerts_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db)) -> schemas.Pro/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "(payload: schemas.ProductCreate, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "delete_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def delete_product($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "fetch_latest_prices_job", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def fetch_latest_prices_job(db: Session = Depends(get_db)) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_price_history", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_price_history($/", "language": "Python", "typeref": "typename:List[schemas.PriceHistoryRead]", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "get_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_product($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "jobs_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "list_alerts", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_alerts(db: Session = Depends(get_db)) -> List[schemas.AlertRead]:$/", "language": "Python", "typeref": "typename:List[schemas.AlertRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "list_products", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_products(db: Session = Depends(get_db)) -> List[schemas.ProductRead]:$/", "language": "Python", "typeref": "typename:List[schemas.ProductRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "pricing_service", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^pricing_service = PricingService()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "products_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_product_patch", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_patch($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "update_product_put", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_put($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}], "hash": "ae98775f4dbc82fa94fb31acf988fe09", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/routers.py", "fields": [{"name": "alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pricing_service = PricingService()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}