{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing products, alerts, and related operations in a web application, including CRUD operations for products, fetching price history, listing alerts, and a job to fetch latest prices and generate alerts.", "external_files": [".db", ".models", ".schemas", ".services"], "external_methods": ["get_db", "PricingService.fetch_latest_price", "maybe_create_alert"], "published": ["list_products", "create_product", "get_product", "update_product_put", "update_product_patch", "delete_product", "get_price_history", "list_alerts", "fetch_latest_prices_job"], "classes": [{"name": "APIRouter", "description": "FastAPI router object used to define route groups for products, alerts, and jobs."}], "methods": [{"name": "List[schemas.ProductRead] list_products(db: Session = Depends(get_db))", "description": "Lists all products with their nested price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db))", "description": "Creates a new product, optionally with an initial price, and stores it in the database.", "scope": "", "scopeKind": ""}, {"name": "models.Product _get_product_or_404(db: Session, product_id: int)", "description": "Retrieves a product by ID or raises a 404 error if not found.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead get_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Retrieves a specific product by ID, including its price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_put( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Replaces a product's fields with provided data (PUT semantics).", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_patch( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Partially updates a product with provided data (PATCH semantics).", "scope": "", "scopeKind": ""}, {"name": "None delete_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Deletes a product and its related data from the database.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.PriceHistoryRead] get_price_history( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Returns all price history entries for a product ordered by timestamp.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.AlertRead] list_alerts(db: Session = Depends(get_db))", "description": "Lists all alerts in the system, ordered by trigger time descending.", "scope": "", "scopeKind": ""}, {"name": "dict fetch_latest_prices_job(db: Session = Depends(get_db))", "description": "Fetches the latest prices for all products, updates their current prices, appends price history, and creates alerts if needed.", "scope": "", "scopeKind": ""}], "calls": ["get_db", "models.Product", "models.PriceHistory", "models.Alert", "datetime.utcnow", "PricingService.fetch_latest_price", "maybe_create_alert", "db.query", "db.add", "db.commit", "db.refresh", "db.delete", "db.order_by"], "search-terms": ["products_router", "alerts_router", "jobs_router", "PriceHistory", "fetch_latest_prices_job", "PricingService", "get_price_history", "list_alerts", "create_product"], "state": 2, "file_id": 9, "knowledge_revision": 22, "git_revision": "", "ctags": [{"_type": "tag", "name": "_get_product_or_404", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def _get_product_or_404(db: Session, product_id: int) -> models.Product:$/", "language": "Python", "typeref": "typename:models.Product", "kind": "function", "signature": "(db: Session, product_id: int)"}, {"_type": "tag", "name": "alerts_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db)) -> schemas.Pro/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "(payload: schemas.ProductCreate, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "delete_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def delete_product($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "fetch_latest_prices_job", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def fetch_latest_prices_job(db: Session = Depends(get_db)) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_price_history", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_price_history($/", "language": "Python", "typeref": "typename:List[schemas.PriceHistoryRead]", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "get_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_product($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "jobs_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "list_alerts", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_alerts(db: Session = Depends(get_db)) -> List[schemas.AlertRead]:$/", "language": "Python", "typeref": "typename:List[schemas.AlertRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "list_products", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_products(db: Session = Depends(get_db)) -> List[schemas.ProductRead]:$/", "language": "Python", "typeref": "typename:List[schemas.ProductRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "pricing_service", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^pricing_service = PricingService()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "products_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_product_patch", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_patch($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "update_product_put", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_put($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}], "hash": "9e0ebf892633c1a153930266ef9fe08a", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/routers.py", "fields": [{"name": "alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pricing_service = PricingService()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"22": ""}]}