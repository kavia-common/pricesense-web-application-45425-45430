{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing products, alerts, and jobs related to price tracking in a web application built with FastAPI. It includes route definitions for CRUD operations on products, retrieving price history, listing alerts, and a background job for fetching latest prices and generating alerts.", "external_files": ["./db", ".", "./models", "./schemas", "./services"], "external_methods": ["get_db", "PricingService.fetch_latest_price", "maybe_create_alert"], "published": ["list_products", "create_product", "get_product", "update_product_put", "update_product_patch", "delete_product", "get_price_history", "list_alerts", "fetch_latest_prices_job"], "classes": [{"name": "products_router", "description": "FastAPI APIRouter instance managing routes related to products."}, {"name": "alerts_router", "description": "FastAPI APIRouter instance managing routes related to alerts."}, {"name": "jobs_router", "description": "FastAPI APIRouter instance managing background job routes."}, {"name": "PricingService", "description": "Service class responsible for fetching latest product prices."}], "methods": [{"name": "List[schemas.ProductRead] list_products(db: Session = Depends(get_db))", "description": "Endpoint to list all products with nested price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db))", "description": "Endpoint to create a new product, optionally with an initial current price.", "scope": "", "scopeKind": ""}, {"name": "models.Product _get_product_or_404(db: Session, product_id: int)", "description": "Utility function to retrieve a product by ID or raise 404 if not found.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead get_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Retrieve a product by ID, including price history and alerts.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_put( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Update a product fully replacing specified fields.", "scope": "", "scopeKind": ""}, {"name": "schemas.ProductRead update_product_patch( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )", "description": "Partially update a product with provided fields.", "scope": "", "scopeKind": ""}, {"name": "None delete_product( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Delete a product and its associated data.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.PriceHistoryRead] get_price_history( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )", "description": "Get all price history entries for a specific product.", "scope": "", "scopeKind": ""}, {"name": "List[schemas.AlertRead] list_alerts(db: Session = Depends(get_db))", "description": "List all alerts ordered by when they were triggered.", "scope": "", "scopeKind": ""}, {"name": "dict fetch_latest_prices_job(db: Session = Depends(get_db))", "description": "Background job to fetch latest prices for all products, update database, and generate alerts.", "scope": "", "scopeKind": ""}], "calls": ["db.query", "db.add", "db.flush", "db.commit", "db.refresh", "PricingService.fetch_latest_price", "maybe_create_alert"], "search-terms": ["products", "alerts", "price history", "fetch-latest", "price tracking", "product management"], "state": 2, "file_id": 9, "knowledge_revision": 35, "git_revision": "36e9a0e239f8dcec505e817915044a6093ff4a45", "revision_history": [{"22": ""}, {"27": "38847bfc104168d7cedc087b9606ac73d68658a5"}, {"30": "38847bfc104168d7cedc087b9606ac73d68658a5"}, {"34": "36e9a0e239f8dcec505e817915044a6093ff4a45"}, {"35": "36e9a0e239f8dcec505e817915044a6093ff4a45"}], "ctags": [{"_type": "tag", "name": "_get_product_or_404", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def _get_product_or_404(db: Session, product_id: int) -> models.Product:$/", "language": "Python", "typeref": "typename:models.Product", "kind": "function", "signature": "(db: Session, product_id: int)"}, {"_type": "tag", "name": "alerts_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def create_product(payload: schemas.ProductCreate, db: Session = Depends(get_db)) -> schemas.Pro/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "(payload: schemas.ProductCreate, db: Session = Depends(get_db))"}, {"_type": "tag", "name": "delete_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def delete_product($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "fetch_latest_prices_job", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def fetch_latest_prices_job(db: Session = Depends(get_db)) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "get_price_history", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_price_history($/", "language": "Python", "typeref": "typename:List[schemas.PriceHistoryRead]", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "get_product", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def get_product($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "jobs_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "list_alerts", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_alerts(db: Session = Depends(get_db)) -> List[schemas.AlertRead]:$/", "language": "Python", "typeref": "typename:List[schemas.AlertRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "list_products", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def list_products(db: Session = Depends(get_db)) -> List[schemas.ProductRead]:$/", "language": "Python", "typeref": "typename:List[schemas.ProductRead]", "kind": "function", "signature": "(db: Session = Depends(get_db))"}, {"_type": "tag", "name": "pricing_service", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^pricing_service = PricingService()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "products_router", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_product_patch", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_patch($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "update_product_put", "path": "/home/kavia/workspace/code-generation/pricesense-web-application-45425-45430/backend/src/api/routers.py", "pattern": "/^def update_product_put($/", "language": "Python", "typeref": "typename:schemas.ProductRead", "kind": "function", "signature": "( product_id: int = Path(..., description=\"Product ID\"), payload: schemas.ProductUpdate = Body(...), db: Session = Depends(get_db), )"}], "hash": "257c248456bc07f7a52ab38b4771517a", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/routers.py", "fields": [{"name": "alerts_router = APIRouter(prefix=\"\\/alerts\", tags=[\"alerts\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "jobs_router = APIRouter(prefix=\"\\/jobs\", tags=[\"jobs\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "pricing_service = PricingService()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "products_router = APIRouter(prefix=\"\\/products\", tags=[\"products\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}